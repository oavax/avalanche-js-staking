"use strict";var e,t=(e=require("regenerator-runtime"))&&"object"==typeof e&&"default"in e?e.default:e,i=require("avalanche-js-crypto"),r=require("avalanche-js-network"),n=require("avalanche-js-transaction"),s=require("avalanche-js-utils"),a=require("text-encoding");function o(e,t,i,r,n,s,a){try{var o=e[s](a),c=o.value}catch(e){return void i(e)}o.done?t(c):Promise.resolve(c).then(r,n)}function c(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var s=e.apply(t,i);function a(e){o(s,r,n,a,c,"next",e)}function c(e){o(s,r,n,a,c,"throw",e)}a(void 0)}))}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u,d=function(){};d.PRECISION=18,d.MAX_DECIMAL=1e18,(u=exports.Directive||(exports.Directive={}))[u.DirectiveCreateValidator=0]="DirectiveCreateValidator",u[u.DirectiveEditValidator=1]="DirectiveEditValidator",u[u.DirectiveDelegate=2]="DirectiveDelegate",u[u.DirectiveUndelegate=3]="DirectiveUndelegate",u[u.DirectiveCollectRewards=4]="DirectiveCollectRewards";var l=function(e){var s,a;function o(t,i,r,s,a,o,c,h){var u;return void 0===c&&(c=n.defaultMessenger),void 0===h&&(h=n.TxStatus.INTIALIZED),(u=e.call(this,c,h)||this).directive=t,u.stakeMsg=i,u.nonce=r,u.gasLimit=a,u.gasPrice=s,u.rawTransaction="0x",u.unsignedRawTransaction="0x",u.signature={r:"",s:"",recoveryParam:0,v:0},u.chainId=o,u.from="0x",u}a=e,(s=o).prototype=Object.create(a.prototype),s.prototype.constructor=s,h(s,a);var u=o.prototype;return u.encode=function(){var e=[];return e.push(this.directive?i.hexlify(this.directive):"0x"),e.push(this.stakeMsg.encode()),e.push(this.nonce?i.hexlify(this.nonce):"0x"),e.push(i.hexlify(this.gasPrice)),e.push(i.hexlify(this.gasLimit)),null!=this.chainId&&0!==this.chainId&&(e.push(i.hexlify(this.chainId)),e.push("0x"),e.push("0x")),[i.encode(e),e]},u.rlpSign=function(e){var t=this.encode(),r=t[0],n=t[1];this.setUnsigned(r);var s=i.sign(i.keccak256(r),e);return[s,this.getRLPSigned(n,s)]},u.getRLPSigned=function(e,t){var r=i.splitSignature(t),n=27+(r.recoveryParam||0);return e.pop(),e.pop(),e.pop(),e.push(i.hexlify(n+=2*this.chainId+8)),e.push(i.stripZeros(i.arrayify(r.r)||[])),e.push(i.stripZeros(i.arrayify(r.s)||[])),i.encode(e)},u.sendTransaction=function(){var e=c(t.mark((function e(){var i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("tx"!==this.rawTransaction&&void 0!==this.rawTransaction){e.next=2;break}throw new Error("Transaction not signed");case 2:if(this.messenger){e.next=4;break}throw new Error("Messenger not found");case 4:return e.next=6,this.messenger.send(r.RPCMethod.SendRawStakingTransaction,this.rawTransaction,this.messenger.chainType,this.messenger.currentShard);case 6:if(!(i=e.sent).isResult()){e.next=14;break}return this.id=i.result,this.emitTransactionHash(this.id),this.setTxStatus(n.TxStatus.PENDING),e.abrupt("return",[this,i.result]);case 14:if(!i.isError()){e.next=20;break}return this.emitConfirm("transaction failed:"+i.error.message),this.setTxStatus(n.TxStatus.REJECTED),e.abrupt("return",[this,"transaction failed:"+i.error.message]);case 20:throw this.emitError("transaction failed"),new Error("transaction failed");case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.setUnsigned=function(e){this.unsignedRawTransaction=e},u.setRawTransaction=function(e){this.rawTransaction=e},u.setSignature=function(e){this.signature={r:e.r,s:e.s,v:e.v,recoveryParam:e.recoveryParam}},u.setNonce=function(e){this.nonce=e},u.setFromAddress=function(e){this.from=e},u.getUnsignedRawTransaction=function(){return this.unsignedRawTransaction},u.getRawTransaction=function(){return this.rawTransaction},u.getSignature=function(){return this.signature},u.getFromAddress=function(){return this.from},u.confirm=function(){var e=c(t.mark((function e(i,r,n,s,a){var o;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=20),void 0===n&&(n=1e3),void 0===s&&(s=this.messenger.currentShard),void 0===a&&(a=0),e.next=6,this.txConfirm(i,r,n,s);case 6:if(o=e.sent,s!==a){e.next=9;break}return e.abrupt("return",o);case 9:if(!o.isConfirmed()){e.next=16;break}return e.next=12,this.cxConfirm(i,r,n,a);case 12:return e.abrupt("return",e.sent);case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n,s){return e.apply(this,arguments)}}(),o}(n.TransactionBase),f=function(){function e(e,t,i,r,n){this.name=e,this.identity=t,this.website=i,this.securityContact=r,this.details=n}return e.prototype.encode=function(){var e=[],t=new a.TextEncoder;return e.push(t.encode(this.name)),e.push(t.encode(this.identity)),e.push(t.encode(this.website)),e.push(t.encode(this.securityContact)),e.push(t.encode(this.details)),e},e}(),p=function(){function e(e){if(0===e.length)throw new Error("decimal string is empty");var t=e;if("-"===e[0])throw new Error("decimal fraction should be be between [0, 1]");if("+"===e[0]&&(t=e.substr(1)),0===t.length)throw new Error("decimal string is empty");if(t.split(" ").length>1)throw new Error("bad decimal string");var i=t.split("."),r=0,n=i[0];if(2===i.length){if(0===(r=i[1].length)||0===n.length)throw new Error("bad decimal length");if("-"===i[1][0])throw new Error("bad decimal string");n+=i[1]}else if(i.length>2)throw new Error("too many periods to be a decimal string");if(r>d.PRECISION)throw new Error("too much precision: precision should be less than "+d.PRECISION);n=(n+="0".repeat(d.PRECISION-r)).replace(/^0+/,"");var a=new s.Unit(n).asWei().toWei();if(a.gt(new s.Unit(d.MAX_DECIMAL.toString()).asWei().toWei()))throw new Error("too large decimal fraction");this.value=a}return e.prototype.encode=function(){var e=[];return e.push(s.numberToHex(this.value)),e},e}(),g=function(){function e(e,t,i){this.rate=e,this.maxRate=t,this.maxChangeRate=i}return e.prototype.encode=function(){var e=[];return e.push(this.rate.encode()),e.push(this.maxRate.encode()),e.push(this.maxChangeRate.encode()),e},e}(),v=function(){function e(e,t,i,r,n,s,a){this.validatorAddress=e,this.description=t,this.commissionRates=i,this.minSelfDelegation=r,this.maxTotalDelegation=n,this.slotPubKeys=s,this.amount=a}var t=e.prototype;return t.encode=function(){var e=[];return e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.validatorAddress))),e.push(this.description.encode()),e.push(this.commissionRates.encode()),e.push(i.hexlify(this.minSelfDelegation)),e.push(i.hexlify(this.maxTotalDelegation)),e.push(this.encodeArr()),e.push(i.hexlify(this.amount)),e},t.encodeArr=function(){var e=[];return this.slotPubKeys.forEach((function(t){e.push(t)})),e},e}(),m=function(){function e(e,t,i,r,n,s,a){this.validatorAddress=e,this.description=t,this.commissionRate=i,this.minSelfDelegation=r,this.maxTotalDelegation=n,this.slotKeyToRemove=s,this.slotKeyToAdd=a}return e.prototype.encode=function(){var e=[];return e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.validatorAddress))),e.push(this.description.encode()),e.push(this.commissionRate.encode()),e.push(i.hexlify(this.minSelfDelegation)),e.push(i.hexlify(this.maxTotalDelegation)),e.push(this.slotKeyToRemove),e.push(this.slotKeyToAdd),e},e}(),x=function(){function e(e,t,i){this.delegatorAddress=e,this.validatorAddress=t,this.amount=i}return e.prototype.encode=function(){var e=[];return e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.delegatorAddress))),e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.validatorAddress))),e.push(i.hexlify(this.amount)),e},e}(),w=function(){function e(e,t,i){this.delegatorAddress=e,this.validatorAddress=t,this.amount=i}return e.prototype.encode=function(){var e=[];return e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.delegatorAddress))),e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.validatorAddress))),e.push(i.hexlify(this.amount)),e},e}(),y=function(){function e(e){this.delegatorAddress=e}return e.prototype.encode=function(){var e=[];return e.push(i.hexlify(n.TransactionBase.normalizeAddress(this.delegatorAddress))),e},e}(),T=function(){function e(e){this.messenger=e,this.nonce=0,this.gasPrice=new s.Unit("100").asGwei().toHex(),this.gasLimit=new s.Unit("210000").asWei().toHex(),this.chainId=1,this.signature={v:0,r:"",s:""}}var t=e.prototype;return t.createValidator=function(e){var t=e.description,i=e.commissionRate,r=e.minSelfDelegation,n=e.maxTotalDelegation,s=e.slotPubKeys,a=e.amount;return this.stakeMsg=new v(e.validatorAddress,new f(t.name,t.identity,t.website,t.securityContact,t.details),new g(new p(i.rate),new p(i.maxRate),new p(i.maxChangeRate)),r,n,s,a),this.directive=exports.Directive.DirectiveCreateValidator,this},t.editValidator=function(e){var t=e.description,i=e.commissionRate,r=e.minSelfDelegation,n=e.maxTotalDelegation,s=e.slotKeyToRemove,a=e.slotKeyToAdd;return this.stakeMsg=new m(e.validatorAddress,new f(t.name,t.identity,t.website,t.securityContact,t.details),new p(i),r,n,s,a),this.directive=exports.Directive.DirectiveEditValidator,this},t.delegate=function(e){return this.stakeMsg=new x(e.delegatorAddress,e.validatorAddress,e.amount),this.directive=exports.Directive.DirectiveDelegate,this},t.undelegate=function(e){return this.stakeMsg=new w(e.delegatorAddress,e.validatorAddress,e.amount),this.directive=exports.Directive.DirectiveUndelegate,this},t.collectRewards=function(e){return this.stakeMsg=new y(e.delegatorAddress),this.directive=exports.Directive.DirectiveCollectRewards,this},t.setTxParams=function(e){var t=e.gasPrice,i=e.gasLimit,r=e.chainId,n=e.signature;return this.nonce=e.nonce,this.gasPrice=t,this.gasLimit=i,this.chainId=r,this.signature=n,this},t.build=function(){if(void 0===this.directive)throw new Error("cannot build stakingTransaction without Directive");if(void 0===this.stakeMsg)throw new Error("cannot build stakingTransaction without stakeMsg");return new l(this.directive,this.stakeMsg,void 0!==this.nonce?this.nonce:0,void 0!==this.gasPrice?this.gasPrice:new s.Unit("100").asGwei().toHex(),void 0!==this.gasLimit?this.gasLimit:new s.Unit("210000").asWei().toHex(),void 0!==this.chainId?this.chainId:1,this.messenger,n.TxStatus.INTIALIZED)},t.setMessenger=function(e){this.messenger=e},e}();exports.CollectRewards=y,exports.CommissionRate=g,exports.CreateValidator=v,exports.Decimal=p,exports.Delegate=x,exports.Description=f,exports.EditValidator=m,exports.StakingFactory=T,exports.StakingSettings=d,exports.StakingTransaction=l,exports.Undelegate=w;
//# sourceMappingURL=avalanche-js-staking.cjs.production.min.js.map
